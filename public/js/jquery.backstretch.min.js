/*! Backstretch - v2.0.4 - 2013-06-19
 * http://srobbin.com/jquery-plugins/backstretch/
 * Copyright (c) 2013 Scott Robbin; Licensed MIT
 *
 * Updated version from https://github.com/FokkeZB/jquery-backstretch @d66f545a9b3e02f161788be7a230b19b76353fda
 * Updated version with navigation stuff by bytehead
 */
!function(t,i,e){"use strict";t.fn.backstretch=function(n,a){return(n===e||0===n.length)&&t.error("No images were supplied for Backstretch"),0===t(i).scrollTop()&&i.scrollTo(0,0),this.each(function(){var i=t(this),e=i.data("backstretch");if(e){if("string"==typeof n.src&&"function"==typeof e[n])return void e[n](a);a=t.extend(e.options,a),e.destroy(!0)}e=new s(this,n,a),i.data("backstretch",e)})},t.backstretch=function(i,e,n){return t(i).length||(i="body"),t(i).backstretch(e,n).data("backstretch")},t.expr[":"].backstretch=function(i){return t(i).data("backstretch")!==e},t.fn.backstretch.defaults={centeredX:!0,centeredY:!0,duration:5e3,fade:0,nav:!1,navClick:!1,navPrevNext:!1};var n={wrap:{left:0,top:0,overflow:"hidden",margin:0,padding:0,height:"100%",width:"100%",zIndex:-999999},img:{position:"absolute",display:"none",margin:0,padding:0,border:"none",width:"auto",height:"auto",maxHeight:"none",maxWidth:"none",zIndex:-999999}},s=function(e,s,r){var o=this;this.options=t.extend({},t.fn.backstretch.defaults,r||{}),this.viewport={};var h=t("meta[name=viewport]").attr("content")?t("meta[name=viewport]").attr("content").split(","):[];t.each(h,function(){var t=this.split("=");o.viewport[t[0]]=t[1]}),this.images=t.isArray(s)?s:[s],t.each(this.images,function(){var i=t("<img />")[0];i.src=this.src,i.alt=this.alt,i.title=this.title}),this.isBody=e===document.body,this.$container=t(e),this.$root=this.isBody?t(a?i:document):this.$container;var c=this.$container.children(".backstretch").first();if(this.$wrap=c.length?c:t('<div class="backstretch"></div>').css(n.wrap).appendTo(this.$container),this.options.caption){var d=this.$container.children(".bs-caption").first();this.$caption=d.lenght?d:t('<figcaption class="bs-caption"></figcaption>'),this.$caption.appendTo(this.$container)}if(this.options.nav){var p=this.$container.children(".bs-nav").first();this.$nav=p.lenght?p:t('<ol class="bs-nav"></ol>'),t.each(this.images,function(i){o.$nav.append(t('<li class="item"></li>').data("idx",i))}),this.options.navPrevNext&&(o.$nav.prepend(t('<li class="item-nav prev"></li>')),o.$nav.append('<li class="item-nav next"></li>')),this.$nav.appendTo(this.$container),this.options.navClick&&(t(".item",o.$nav).on("click",function(i){return i.preventDefault(),o.show(t(this).data("idx")),!1}),this.options.navPrevNext&&t(".item-nav").on("click",function(i){return i.preventDefault(),t(i.target).hasClass("prev")&&o.prev(),t(i.target).hasClass("next")&&o.next(),!1}))}if(!this.isBody){var l=this.$container.css("position"),v=this.$container.css("zIndex");this.$container.css({position:"static"===l?"relative":l,zIndex:"auto"===v?0:v,background:"none"}),this.$wrap.css({zIndex:-999998})}this.$wrap.css({position:this.isBody&&a?"fixed":"absolute"}),this.index=0,this.show(this.index),t(i).on("resize.backstretch",t.proxy(this.resize,this)).on("orientationchange.backstretch",t.proxy(function(){this.isBody&&0===i.pageYOffset&&(i.scrollTo(0,1),this.resize())},this))};s.prototype={resize:function(){try{var e,n={left:0,top:0},s=Math.ceil(i.innerWidth/i.innerHeight)>Math.ceil(screen.width/screen.height),a=this.isBody?r?s?screen.height:screen.width:this.$root.width():this.$root.innerWidth(),o=a,h=this.isBody?r?s?screen.width:screen.height:i.innerHeight?i.innerHeight:this.$root.height():this.$root.innerHeight(),c=o/this.$img.data("ratio");if(r&&t.isEmptyObject(this.viewport)?(a=t(document).width(),o=a,h=t(document).height(),c=o/this.$img.data("ratio")):r&&!t.isEmptyObject(this.viewport)&&"device-width"!=this.viewport.width&&(a=parseInt(this.viewport.width),o=a,h=t(document).height(),c=o/this.$img.data("ratio")),isNaN(c))return this;c>=h?(e=(c-h)/2,this.options.centeredY&&(n.top="-"+e+"px")):(c=h,o=c*this.$img.data("ratio"),e=(o-a)/2,this.options.centeredX&&(n.left="-"+e+"px")),this.$wrap.css({width:a,height:h}).find("img:not(.deleteable)").css({width:o,height:c}).css(n)}catch(d){}return this},show:function(i){if(!(Math.abs(i)>this.images.length-1)){var e=this,s=e.$wrap.find("img").addClass("deleteable"),a={relatedTarget:e.$container[0]};return e.$container.trigger(t.Event("backstretch.before",a),[e,i]),this.index=i,clearInterval(e.interval),e.$img=t("<img />").css(n.img).bind("load",function(n){var r=this.width||t(n.target).width(),o=this.height||t(n.target).height();t(this).data("ratio",r/o),e.options.nav&&(t(".bs-nav .item.active").removeClass("active"),t(t(".bs-nav .item").get(i)).addClass("active")),t(this).fadeIn(e.options.speed||e.options.fade,function(){s.remove(),e.paused||e.cycle(),t(["after","show"]).each(function(){e.$container.trigger(t.Event("backstretch."+this,a),[e,i])})}),e.resize()}).appendTo(e.$wrap),e.$img.attr("src",e.images[i].src),e.$img.attr("alt",e.images[i].alt),e.$img.attr("title",e.images[i].title),this.options.caption&&e.$caption.first().html(e.images[i].caption),e}},next:function(){return this.show(this.index<this.images.length-1?this.index+1:0)},prev:function(){return this.show(0===this.index?this.images.length-1:this.index-1)},pause:function(){return this.paused=!0,this},resume:function(){return this.paused=!1,this.next(),this},cycle:function(){return this.images.length>1&&(clearInterval(this.interval),this.interval=setInterval(t.proxy(function(){this.paused||this.next()},this),this.options.duration)),this},destroy:function(e){t(i).off("resize.backstretch orientationchange.backstretch"),clearInterval(this.interval),e||this.$wrap.remove(),this.$container.removeData("backstretch")}};var a=function(){var t=navigator.userAgent,e=navigator.platform,n=t.match(/AppleWebKit\/([0-9]+)/),s=!!n&&n[1],a=t.match(/Fennec\/([0-9]+)/),r=!!a&&a[1],o=t.match(/Opera Mobi\/([0-9]+)/),h=!!o&&o[1],c=t.match(/MSIE ([0-9]+)/),d=!!c&&c[1];return!((e.indexOf("iPhone")>-1||e.indexOf("iPad")>-1||e.indexOf("iPod")>-1)&&s&&534>s||i.operamini&&"[object OperaMini]"==={}.toString.call(i.operamini)||o&&7458>h||t.indexOf("Android")>-1&&s&&533>s||r&&6>r||"palmGetResource"in i&&s&&534>s||t.indexOf("MeeGo")>-1&&t.indexOf("NokiaBrowser/8.5.0")>-1||d&&6>=d)}(),r=function(){try{return document.createEvent("TouchEvent"),!0}catch(t){return!1}}()}(jQuery,window);
